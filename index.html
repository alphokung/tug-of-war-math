<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Tug-of-War Battle</title>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">

    <!-- SEO & Open Graph -->
    <meta name="description"
        content="A real-time local multiplayer math battle! Pull the rope by solving math problems faster than your opponent.">
    <meta property="og:title" content="Math Tug-of-War Battle" />
    <meta property="og:description"
        content="A real-time local multiplayer math battle! Pull the rope by solving math problems faster than your opponent." />
    <meta property="og:alt"
        content="A real-time local multiplayer math battle! Pull the rope by solving math problems faster than your opponent." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="assets/og.webp" />
    <meta property="og:url" content="https://tug-of-war-math.pages.dev/" />

    <!-- Optimization: Preconnect to Font Origins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Optimization: Load Fonts directly with display swap -->

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Optimization: Inlined CSS to prevent render blocking -->
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            touch-action: none;
            /* Prevent Pull-to-refresh on mobile */
            -webkit-user-select: none;
            user-select: none;
        }

        /* Custom Shake Animation Class */
        .shake {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both;
        }

        /* Character Idle/Pull Motion */
        .heave {
            animation: heaveHo 1s infinite alternate ease-in-out;
        }

        /* Lightning Flash */
        .flash-effect {
            animation: flash 0.3s ease-out;
        }

        @keyframes flash {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(-50%);
            }

            20% {
                opacity: 1;
                transform: scale(1.2) translateY(-50%);
            }

            40% {
                opacity: 1;
                transform: scale(1) translateY(-50%);
            }

            100% {
                opacity: 0;
                transform: scale(1.5) translateY(-50%);
            }
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'p1-blue': '#3B82F6',
                        'p2-red': '#EF4444',
                    },
                    animation: {
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'heave-ho': 'heaveHo 1s infinite alternate',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        heaveHo: {
                            '0%': { transform: 'rotate(-2deg)' },
                            '100%': { transform: 'rotate(2deg)' }
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-yellow-50 overflow-hidden touch-none select-none">
    <!-- Portrait Mode Warning Overlay -->
    <div id="rotate-overlay"
        class="fixed inset-0 bg-yellow-400 z-[60] flex flex-col items-center justify-center p-8 text-center hidden portrait:flex">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="text-red-600 animate-pulse mb-4">
            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path>
            <path d="M3 3v9h9"></path>
        </svg>
        <h2 class="text-3xl font-black text-red-600 mb-2 uppercase tracking-widest"
            style="-webkit-text-stroke: 1px black;">Rotate Device</h2>
        <p class="text-xl text-yellow-900 font-bold">This battle requires LANDSCAPE mode!</p>
    </div>

    <!-- Main Game Container -->
    <div id="game-container"
        class="relative w-screen h-[100dvh] bg-stone-800 flex flex-row hidden landscape:flex overflow-hidden">

        <!-- Audio Control Button (Absolute Top Right of Screen) -->
        <button id="audio-btn"
            class="fixed top-4 right-4 z-[999] bg-white/80 p-3 rounded-full shadow-lg border-2 border-yellow-500 hover:bg-yellow-100 transition-transform hover:scale-110 active:scale-95">
            <!-- Icon: Sound On -->
            <svg id="icon-sound-on" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-600 block">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
            <!-- Icon: Mute -->
            <svg id="icon-sound-off" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 hidden">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <line x1="23" y1="9" x2="17" y2="15"></line>
                <line x1="17" y1="9" x2="23" y2="15"></line>
            </svg>
        </button>

        <!-- LEFT COLUMN: PLAYER 1 CONTROLS (Rotated 90deg) -->
        <!-- Logic: Container W is ~25%, H is 100%. Inner wrapper W is 100h, H is 25w. Rotated 90. -->
        <div
            class="w-[25%] h-full bg-blue-50 border-r-4 border-yellow-500 relative flex items-center justify-center z-30">
            <div class="absolute w-[100vh] h-[25vw] flex flex-col p-4 transform rotate-90 origin-center">

                <!-- P1 Power Bar -->
                <div class="w-1/2 mx-auto mb-4">
                    <div
                        class="h-6 bg-gray-900 border-2 border-yellow-400 rotate-180 relative overflow-hidden shadow-lg rounded-sm">
                        <div id="p1-power-bar"
                            class="h-full bg-gradient-to-r from-blue-700 via-blue-500 to-cyan-400 transition-all duration-300 ease-out w-0 relative">
                            <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                        </div>
                    </div>
                    <div class="text-center text-xs font-bold text-blue-800 tracking-widest mt-1">P1 POWER</div>
                </div>

                <!-- P1 Problem -->
                <div class="flex-1 flex items-center justify-center">
                    <div id="p1-problem"
                        class="text-6xl md:text-8xl font-bold text-gray-800 tracking-wider drop-shadow-sm select-none">
                        ? + ?
                    </div>
                </div>

                <!-- P1 Options -->
                <div id="p1-options" class="grid grid-cols-3 gap-4 h-1/3 mt-4">
                    <!-- Buttons generated by JS -->
                </div>
            </div>
        </div>

        <!-- MIDDLE COLUMN: BATTLE ARENA -->
        <div class="flex-1 relative flex items-center justify-center overflow-hidden border-x-4 border-orange-500"
            id="battle-arena">
            <!-- Stadium Background -->
            <div class="absolute inset-0 z-0 flex flex-col">
                <!-- Crowd / Stands (Top) -->
                <div
                    class="h-1/6 bg-gray-800 flex items-end justify-center overflow-hidden relative border-b-4 border-yellow-600">
                    <div class="absolute inset-0 opacity-30"
                        style="background-image: radial-gradient(circle, white 2px, transparent 2.5px); background-size: 10px 10px;">
                    </div>
                    <div class="absolute bottom-0 w-full h-8 bg-gradient-to-t from-black/50 to-transparent"></div>
                </div>
                <!-- Grass Field -->
                <div class="flex-1 bg-green-600 relative overflow-hidden">
                    <!-- Grass Stripes -->
                    <div class="absolute inset-0 opacity-20"
                        style="background: repeating-linear-gradient(90deg, transparent, transparent 50px, #000 50px, #000 100px);">
                    </div>
                    <!-- Center Line -->
                    <div class="absolute left-1/2 top-0 bottom-0 w-2 bg-white/50 -translate-x-1/2"></div>
                    <!-- Center Circle -->
                    <div
                        class="absolute left-1/2 top-1/2 w-48 h-48 border-4 border-white/30 rounded-full -translate-x-1/2 -translate-y-1/2">
                    </div>
                </div>
            </div>

            <!-- Win Zones -->
            <div
                class="absolute left-0 top-0 bottom-0 w-1/6 bg-blue-500/20 border-r-4 border-blue-400 border-dashed flex items-center justify-center z-10">
                <span class="text-blue-200 font-bold opacity-70 -rotate-90 text-2xl tracking-widest">GOAL</span>
            </div>
            <div
                class="absolute right-0 top-0 bottom-0 w-1/6 bg-red-500/20 border-l-4 border-red-400 border-dashed flex items-center justify-center z-10">
                <span class="text-red-200 font-bold opacity-70 rotate-90 text-2xl tracking-widest">GOAL</span>
            </div>

            <!-- Rope & Characters Container -->
            <div id="rope-system"
                class="relative w-full flex items-center justify-center transition-transform duration-300 ease-out z-20">
                <!-- The Rope -->
                <div class="absolute h-4 md:h-6 w-[150%] left-[-25%] shadow-lg transition-transform duration-300 ease-out"
                    style="background-image: url('assets/rope.webp'); background-repeat: repeat-x; background-size: auto 100%;">
                </div>
                <!-- Rope Knot/Center -->
                <img src="assets/knott.webp" alt="Rope Knot"
                    class="absolute h-8 md:h-10 w-auto z-10 drop-shadow-md filter brightness-110">

                <!-- Player 1 Character Wrapper -->
                <div class="absolute right-1/2 mr-24">
                    <div id="p1-char" class="animate-heave-ho origin-bottom">
                        <svg width="60" height="60" viewBox="0 0 100 100" class="drop-shadow-lg">
                            <circle cx="50" cy="30" r="20" fill="#3B82F6" />
                            <path d="M30 50 Q50 90 70 50 L70 100 L30 100 Z" fill="#2563EB" />
                            <rect x="20" y="55" width="20" height="10" fill="#1D4ED8" rx="5" />
                            <rect x="60" y="55" width="20" height="10" fill="#1D4ED8" rx="5" />
                            <circle cx="58" cy="25" r="3" fill="black" />
                            <circle cx="60" cy="25" r="1" fill="white" />
                            <path d="M55 38 Q60 42 65 38" fill="none" stroke="black" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M28 20 Q50 10 72 20 L72 26 Q50 16 28 26 Z" fill="#1D4ED8" />
                        </svg>
                    </div>
                </div>

                <!-- Player 2 Character Wrapper -->
                <div class="absolute left-1/2 ml-24 scale-x-[-1]">
                    <div id="p2-char" class="animate-heave-ho origin-bottom">
                        <svg width="60" height="60" viewBox="0 0 100 100" class="drop-shadow-lg">
                            <path d="M35 90 L35 100 M65 90 L65 100" stroke="#991B1B" stroke-width="8"
                                stroke-linecap="round" />
                            <path d="M30 50 Q50 90 70 50 L70 90 L30 90 Z" fill="#DC2626" />
                            <circle cx="50" cy="30" r="22" fill="#F87171" />
                            <circle cx="58" cy="25" r="3" fill="black" />
                            <circle cx="60" cy="25" r="1" fill="white" />
                            <path d="M55 38 Q60 42 65 38" fill="none" stroke="black" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M28 20 Q50 10 72 20 L72 26 Q50 16 28 26 Z" fill="#B91C1C" />
                            <rect x="50" y="55" width="25" height="12" fill="#B91C1C" rx="6"
                                transform="rotate(-10 50 55)" />
                            <rect x="25" y="55" width="25" height="12" fill="#B91C1C" rx="6"
                                transform="rotate(10 25 55)" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Lightning Effects Overlay -->
            <div id="fx-layer" class="absolute inset-0 pointer-events-none overflow-hidden">
                <div id="p1-lightning" class="absolute left-10 top-1/2 -translate-y-1/2 hidden z-20">
                    <svg width="400" height="200" viewBox="0 0 400 200"
                        class="drop-shadow-[0_0_15px_rgba(255,255,0,0.8)]">
                        <path d="M0,100 L150,80 L120,120 L300,50 L250,150 L400,100" fill="none" stroke="#FEF08A"
                            stroke-width="8" stroke-linecap="round" stroke-linejoin="round" class="animate-pulse" />
                    </svg>
                </div>
                <div id="p2-lightning" class="absolute right-10 top-1/2 -translate-y-1/2 hidden z-20 scale-x-[-1]">
                    <svg width="400" height="200" viewBox="0 0 400 200"
                        class="drop-shadow-[0_0_15px_rgba(255,255,0,0.8)]">
                        <path d="M0,100 L150,80 L120,120 L300,50 L250,150 L400,100" fill="none" stroke="#FEF08A"
                            stroke-width="8" stroke-linecap="round" stroke-linejoin="round" class="animate-pulse" />
                    </svg>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: PLAYER 2 CONTROLS (Rotated -90deg) -->
        <div
            class="w-[25%] h-full bg-red-50 border-l-4 border-yellow-500 relative flex items-center justify-center z-30">
            <div class="absolute w-[100vh] h-[25vw] flex flex-col p-4 transform -rotate-90 origin-center">

                <!-- P2 Power Bar -->
                <div class="w-1/2 mx-auto mb-4 scale-x-[-1]">
                    <!-- Mirrored so it fills from center outwards relative to the screen center? 
                          Wait, P2 Power bar usually fills from right to left?
                          In previous layout: right alignment.
                          Here, rotated -90. Top is "Left" of screen (towards arena), Bottom is "Right" edge.
                          If we want it to fill from Arena outwards?
                          Or just standard Left-to-Right reading?
                          Let's keep it simple standard bar.
                     -->
                    <div
                        class="h-6 bg-gray-900 border-2 border-yellow-400 rotate-180 relative overflow-hidden shadow-lg rounded-sm">
                        <div id="p2-power-bar"
                            class="h-full bg-gradient-to-r from-red-700 via-red-500 to-orange-400 transition-all duration-300 ease-out w-0 relative">
                            <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                        </div>
                    </div>
                    <!-- Text needs to be un-mirrored if container is mirrored -->
                </div>
                <div class="text-center text-xs font-bold text-red-800 tracking-widest mt-1">P2 POWER</div>

                <!-- P2 Problem -->
                <div class="flex-1 flex items-center justify-center">
                    <div id="p2-problem"
                        class="text-6xl md:text-8xl font-bold text-gray-800 tracking-wider drop-shadow-sm select-none">
                        ? + ?
                    </div>
                </div>

                <!-- P2 Options -->
                <div id="p2-options" class="grid grid-cols-3 gap-4 h-1/3 mt-4">
                    <!-- Buttons generated by JS -->
                </div>
            </div>
        </div>

    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="fixed inset-0 bg-yellow-400 flex flex-col items-center justify-center z-50 p-4">
        <!-- Exciting SVG Logo -->
        <svg viewBox="0 0 600 300"
            class="w-full max-w-2xl h-auto mb-4 md:mb-8 drop-shadow-2xl hover:scale-105 transition-transform duration-300">
            <defs>
                <!-- Gradients -->
                <linearGradient id="textGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" /> <!-- Gold -->
                    <stop offset="50%" style="stop-color:#FF8C00;stop-opacity:1" /> <!-- Dark Orange -->
                    <stop offset="100%" style="stop-color:#FF4500;stop-opacity:1" /> <!-- Red Orange -->
                </linearGradient>
                <linearGradient id="battleGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" /> <!-- Red -->
                    <stop offset="50%" style="stop-color:#b91c1c;stop-opacity:1" /> <!-- Dark Red -->
                    <stop offset="100%" style="stop-color:#7f1d1d;stop-opacity:1" /> <!-- Very Dark Red -->
                </linearGradient>

                <!-- Filters for 3D/Glow effect -->
                <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur stdDeviation="3" result="blur" />
                    <feComposite in="SourceGraphic" in2="blur" operator="over" />
                </filter>
                <filter id="hardShadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feDropShadow dx="4" dy="4" stdDeviation="0" flood-color="black" flood-opacity="1" />
                </filter>
            </defs>

            <!-- TUG OF WAR -->
            <g transform="translate(300, 120)">
                <!-- Shadow/Stroke Layer -->
                <text x="0" y="0" text-anchor="middle" font-family="'Noto Sans', sans-serif" font-weight="900"
                    font-size="80" fill="none" stroke="black" stroke-width="12" stroke-linejoin="round"
                    transform="scale(1, 1)">TUG OF WAR</text>
                <!-- Main Text Layer -->
                <text x="0" y="0" text-anchor="middle" font-family="'Noto Sans', sans-serif" font-weight="900"
                    font-size="80" fill="url(#textGradient)" filter="url(#hardShadow)" transform="scale(1, 1)">TUG OF
                    WAR</text>
                <!-- Internal Highlight -->
                <text x="0" y="0" text-anchor="middle" font-family="'Noto Sans', sans-serif" font-weight="900"
                    font-size="80" fill="url(#textGradient)" stroke="white" stroke-width="2" stroke-opacity="0.5"
                    transform="scale(1, 1)">TUG OF WAR</text>
            </g>

            <!-- BATTLE (Heavier, blockier) -->
            <g transform="translate(300, 240)">
                <!-- Backing Shape (Optional, maybe just text) -->

                <!-- Shadow/Stroke -->
                <text x="0" y="0" text-anchor="middle" font-family="'Noto Sans', sans-serif" font-weight="900"
                    font-size="110" fill="none" stroke="black" stroke-width="16" stroke-linejoin="round"
                    style="letter-spacing: 0.1em;">BATTLE</text>
                <!-- Main Fill -->
                <text x="0" y="0" text-anchor="middle" font-family="'Noto Sans', sans-serif" font-weight="900"
                    font-size="110" fill="url(#battleGradient)" filter="url(#hardShadow)"
                    style="letter-spacing: 0.1em;">BATTLE</text>
                <!-- Cracks/Texture could go here -->
                <path d="M150,-20 L180,10 M-150,-20 L-120,10" stroke="black" stroke-width="5" opacity="0.3" />
            </g>

            <!-- Dynamic Elements (Sparks/Stars) -->
            <g fill="#FFD700" filter="url(#glow)">
                <circle cx="50" cy="50" r="5" class="animate-pulse" />
                <circle cx="550" cy="50" r="8" class="animate-pulse" style="animation-duration: 1.5s" />
                <circle cx="20" cy="200" r="6" class="animate-pulse" style="animation-duration: 0.8s" />
                <circle cx="580" cy="220" r="4" class="animate-pulse" style="animation-duration: 1.2s" />
            </g>
        </svg>
        <button id="start-btn"
            class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white text-2xl md:text-4xl font-bold py-4 px-8 md:py-6 md:px-12 rounded-2xl border-b-4 md:border-b-8 border-red-800 active:translate-y-2 active:border-b-0 shadow-xl transition-all transform hover:scale-105">
            START GAME
        </button>
        <p class="mt-4 md:mt-8 text-lg md:text-xl text-yellow-800 font-bold text-center">2 Players â€¢ Local Multiplayer
        </p>
        <div class="absolute bottom-2 right-2 md:bottom-4 md:right-4 text-white text-light text-xs md:text-sm">v.1.0.1 |
            @alphokung</div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdown-overlay"
        class="fixed inset-0 bg-yellow-400/90 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div id="countdown-text"
            class="text-6xl md:text-9xl font-black text-white drop-shadow-2xl stroke-black scale-150 transition-transform duration-200"
            style="-webkit-text-stroke: 4px black;">
            3
        </div>
    </div>

    <!-- Winner Overlay (Dialog Style) -->
    <div id="winner-overlay"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-500">
        <!-- Fireworks Canvas -->
        <canvas id="fireworks" class="absolute inset-0 pointer-events-none"></canvas>

        <!-- Victory Dialog Card -->
        <div id="winner-card"
            class="bg-white rounded-3xl p-8 md:p-12 shadow-2xl border-8 border-yellow-400 relative z-10 text-center transform scale-0 transition-transform duration-500 cubic-bezier(0.34, 1.56, 0.64, 1)">
            <div
                class="absolute -top-12 left-1/2 -translate-x-1/2 bg-yellow-400 text-yellow-900 font-black text-2xl md:text-3xl px-8 py-2 rounded-full border-4 border-white shadow-lg uppercase tracking-widest whitespace-nowrap">
                VICTORY!
            </div>

            <h2 id="winner-text" class="text-5xl md:text-7xl font-bold mb-2 mt-4 drop-shadow-md">
                BLUE WINS!
            </h2>
            <p class="text-gray-500 font-bold text-xl mb-8">The rope has been conquered!</p>

            <button id="restart-btn"
                class="bg-gradient-to-b from-green-400 to-green-600 hover:from-green-500 hover:to-green-700 text-white text-3xl md:text-4xl font-bold py-4 px-12 rounded-2xl border-b-8 border-green-800 active:border-b-0 active:translate-y-2 shadow-2xl transition-all w-full md:w-auto">
                PLAY AGAIN
            </button>
        </div>
    </div>

    <script src="script.js" defer></script>


    <script type="text/javascript">
        window.addEventListener('load', function () {
            setTimeout(function () {
                (function (c, l, a, r, i, t, y) {
                    c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
                    t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
                    y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
                })(window, document, "clarity", "script", "vgja1875tr");

            }, 1000);
        });
    </script>
</body>

</html>